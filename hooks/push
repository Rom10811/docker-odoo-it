#!/bin/bash
set -ex

# Login
docker login \
    --username $REGISTRY_USERNAME \
    --password $REGISTRY_PASSWORD \
    $REGISTRY_HOST

# Tag
docker image tag $DOCKER_REPO:$DOCKER_TAG $REGISTRY_HOST/$DOCKER_REPO:$DOCKER_TAG
docker image push $REGISTRY_HOST/$DOCKER_REPO:$DOCKER_TAG

# If it's a release, tag and push
if [! -z "$RELEASE" ]; then
    docker image tag $DOCKER_REPO:$DOCKER_TAG $REGISTRY_HOST/$DOCKER_REPO:$DOCKER_TAG.$RELEASE
    docker image push $REGISTRY_HOST/$DOCKER_REPO:$DOCKER_TAG.$RELEASE
fi
